package com.tujia.myssm.web.backdoor;

import java.io.IOException;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.IntStream;
import org.junit.Test;
import com.fasterxml.jackson.core.TreeNode;
import com.fasterxml.jackson.databind.node.TextNode;
import com.tujia.myssm.common.utils.JsonUtils;
import lombok.extern.slf4j.Slf4j;

/**
 *
 * @author: songlinl
 * @create: 2021/11/05 12:00
 */
@Slf4j
public class DoorControllerTest {

    @Test
    public void testPromoGen() {
        IntStream.range(0, 128).forEach(idx -> {

            System.out.println("SELECT * FROM Promo_" + idx + " WHERE flow_status = 10 AND to_time < now() ORDER BY to_time ASC LIMIT 200;");

        });
    }

    @Test
    public void diff() throws IOException {
        String json = "{\"errcode\": 0, \"data\": {\"query\": \"\", \"member_id\": \"songlinl\", \"limit\": 50, \"offset\": 0, \"total\": 29, \"hits\": [{\"app_code\": \"in_tujia_bnb\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.partner.tujia.in_tujia_bnb\", \"resource_type\": \"host\", \"tags\": {\"kafka\": \"Kafka\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\"}}, {\"app_code\": \"tu_call_rt\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_call_rt\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_galaxy\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_galaxy\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_booking\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_booking\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_ctrip_booking\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_ctrip_booking\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_ctrip_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_ctrip_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_ctrip_task\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_ctrip_task\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_ctrip_web\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_ctrip_web\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_new_ctrip\", \"binded\": true, \"level\": \"P2\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_hds_new_ctrip\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"app_relation\": \"\\u5e94\\u7528\\u5173\\u8054\\u5173\\u7cfb\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_new_ctrip_provider\", \"binded\": true, \"level\": \"P2\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_hds_new_ctrip_provider\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\", \"container_scribe\": \"\\u5bb9\\u5668\\u65e5\\u5fd7\\u6536\\u96c6\"}}, {\"app_code\": \"tu_hds_order_task\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_order_task\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\"}}, {\"app_code\": \"tu_hds_price_server\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_price_server\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"container\": \"\\u5bb9\\u5668\"}}, {\"app_code\": \"tu_hds_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_task\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_task\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_hds_web\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.supply_tech_center.hds.tu_hds_web\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_open_price_check\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_open_price_check\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_open_price_city_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_open_price_city_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_open_price_offline_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_open_price_offline_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_open_price_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_open_price_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_open_price_task\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_open_price_task\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_promo_async\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_promo_async\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_promo_man\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_promo_man\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\"}}, {\"app_code\": \"tu_promotion_web\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_promotion_web\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_promo_web\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_promo_web\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"kafka\": \"Kafka\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_salespromotion_man\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_salespromotion_man\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"app_relation\": \"\\u5e94\\u7528\\u5173\\u8054\\u5173\\u7cfb\", \"new_qmonitor\": \"\\u65b0Qmonitor\", \"container_scribe\": \"\\u5bb9\\u5668\\u65e5\\u5fd7\\u6536\\u96c6\"}}, {\"app_code\": \"tu_salespromotion_provider\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_salespromotion_provider\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"scribe\": \"\\u65e5\\u5fd7\\u6536\\u96c6\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_salespromotion_task\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_salespromotion_task\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_tns_quest\", \"binded\": true, \"level\": \"P3\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_tns_quest\", \"resource_type\": \"host\", \"tags\": {\"host\": \"\\u4e3b\\u673a\", \"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"container\": \"\\u5bb9\\u5668\", \"new_qmonitor\": \"\\u65b0Qmonitor\"}}, {\"app_code\": \"tu_user_promotion\", \"binded\": true, \"level\": \"P2\", \"tree_node\": \"qunar.tujia.tujia.transaction.price_promotion.tu_user_promotion\", \"resource_type\": \"host\", \"tags\": {\"qmon\": \"\\u4e3b\\u673a\\u62a5\\u8b66\", \"nginx\": \"\\u8d1f\\u8f7d\\u5747\\u8861\"}}], \"tag_code\": \"\"}, \"message\": null, \"msg_en\": null}";
        TreeNode root = JsonUtils.getObjectMapperInstance().readTree(json);
        TreeNode treeNode = root.get("data").get("hits");
        if (treeNode.isArray()) {
            List<TreeNode> app_code = IntStream.range(0, treeNode.size()).mapToObj(treeNode::get).collect(Collectors.toList());
            String res = app_code.stream().map(t -> (TextNode) t.get("app_code")).map(TextNode::textValue).reduce("", (a, b) -> a + "," + b);
            System.out.println("res = " + res);
        }
        System.out.println("json = " + json);
    }

}
